<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0; /* 기본 마진 제거 */
            overflow: hidden; /* body의 스크롤 제거 */
        }

        .chart-container {
            width: 100%;
            height: 100vh; /* 화면 전체 높이 사용 */
            overflow-y: auto; /* 세로 스크롤 가능 */
            overflow-x: auto; /* 가로 스크롤 가능 */
        }
    </style>
</head>
<body>
<div class="chart-container">
    <p style="font-size: small; color: gray;">바를 누르면 해당 URL로 이동합니다.</p>
    <canvas id="shortsChart" width="400"></canvas>
</div>
<script th:inline="javascript">
    /*<![CDATA[*/

    // shorts 배열에 200개의 예제 데이터를 생성합니다.
    var shorts = Array.from({ length: 200 }, (_, i) => ({
        title: `Short ${i + 1}`,  // 예제 제목
        views: Math.floor(Math.random() * 1000),  // 무작위 조회수
        url: `https://example.com/short${i + 1}`  // 예제 URL
    }));

    var labels = shorts.map(function(short) {
        return short.title; // 라벨 이름만 반환
    });

    var data = shorts.map(function(short) {
        return short.views;
    });

    // 각 쇼츠별로 다른 색상을 지정
    var backgroundColors = shorts.map(function(_, index) {
        const colors = [
            'rgb(75, 192, 192)',
            'rgb(255, 99, 132)',
            'rgb(255, 206, 86)',
            'rgb(54, 162, 235)',
            'rgb(153, 102, 255)'
        ];
        return colors[index % colors.length]; // 색상 순환 사용
    });

    var borderColors = backgroundColors;

    var ctx = document.getElementById('shortsChart').getContext('2d');
    var shortsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Views',
                data: data,
                backgroundColor: backgroundColors,
                borderColor: borderColors,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,  // 차트 크기가 화면에 맞춰 반응형으로 조정됨
            maintainAspectRatio: false,  // 차트 비율 고정 해제
            indexAxis: 'y', // 'y'로 설정하여 행과 열을 바꿈
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        maxTicksLimit: 200,  // X축에 최대 200개의 라벨만 표시
                    }
                },
                y: {
                    barPercentage: 0.5, // 바의 너비를 조정
                    categoryPercentage: 0.8, // 카테고리 간의 간격 조정
                    ticks: {
                        autoSkip: false,  // 모든 라벨 표시
                        padding: 10, // 라벨과 바 사이의 간격 조정
                    }
                }
            },
            onClick: function(e) {
                var activePoints = shortsChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                if (activePoints.length > 0) {
                    var index = activePoints[0].index;
                    window.open(shorts[index].url, '_blank');
                }
            }
        }
    });
    /*]]>*/
</script>
</body>
</html>